# 重排(重新生成布局，重新排列元素) 重绘(元素的外观被改变)

在 HTML 中，重排（也称为回流/reflow）和重绘是浏览器渲染页面的两个重要过程，它们涉及到 DOM（文档对象模型）和 CSSOM（CSS 对象模型）的变更如何影响页面的最终呈现。下面将详细解释这两个概念及其相关细节。

## 重排（Reflow/回流）

**定义**：
重排是指当渲染树中的一部分（或全部）因为元素的规模尺寸、布局、隐藏等属性的改变而需要重新构建的过程。这涉及到浏览器重新计算元素的几何属性（如位置和尺寸），并将其安放在界面中的正确位置。

**触发条件**：

1. 页面渲染初始化（无法避免）。
2. 添加或删除可见的 DOM 元素。
3. 元素位置的改变，如通过 CSS 改变元素的`position`属性或使用动画。
4. 元素尺寸的改变，包括大小、外边距、内边距、边框等。
5. 浏览器窗口尺寸的变化（如 resize 事件发生时）。
6. 填充内容的改变，如文本的改变或图片大小改变引起的计算值宽度和高度的改变。
7. 读取某些元素属性，如`offsetLeft`、`offsetTop`、`offsetHeight`、`offsetWidth`等。

**影响**：
重排是一个较为昂贵的操作，因为它可能导致页面上的其他元素也重新排列。因此，频繁的重排会导致性能问题，如页面卡顿。

## 重绘（Repaint）

**定义**：
重绘是指当元素的外观发生改变，但没有改变布局（即元素的几何属性未变），浏览器重新把元素外观绘制出来的过程。这通常涉及颜色的变化、字体样式的调整等。

**触发条件**：

1. 改变元素的外观属性，如`color`、`background-color`、`border-color`等。
2. 设置元素的阴影、圆角等不影响布局的 CSS 属性。

**与重排的关系**：
重排必定会引发重绘，因为重排后需要重新绘制受影响的部分到屏幕中。但重绘不一定会引发重排。例如，仅改变一个元素的背景颜色时，只会触发重绘而不会触发重排。

## 优化建议

为了减少重排和重绘对页面性能的影响，可以采取以下优化措施：

1. **合并 DOM 和样式的修改**：将多次修改合并为一次操作，可以减少重排和重绘的次数。
2. **使用 CSS 类来更改样式**：通过改变元素的类名来应用样式更改，而不是直接操作样式属性。
3. **避免在循环中读取或修改 DOM**：循环中的 DOM 操作会被频繁地执行，从而触发多次重排和重绘。
4. **使用绝对定位**：对于需要频繁变化的元素，可以使用绝对定位来避免对其他元素造成影响。
5. **利用文档片段（DocumentFragment）**：在文档片段上进行操作，然后一次性添加到文档中，可以减少重排和重绘的次数。
6. **启用 GPU 加速**：对于某些复杂的动画和图形效果，可以利用 GPU 的图形性能来加速渲染过程。

通过以上措施，可以有效地减少 HTML 页面中的重排和重绘次数，提升页面的性能和用户体验。
