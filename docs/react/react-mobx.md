# 什么是 MobX？

MobX 是一个简单、可扩展的状态管理库，它通过透明的函数式响应式编程（TFRP）使得状态管理变得既简单又强大。以下是 MobX 原理的详细解释：

## 1. 核心概念

MobX 的核心概念包括可观察状态（Observable）、动作（Actions）、计算值（Computed Values）和反应（Reactions）。

- **可观察状态（Observable）**：MobX 将应用程序的状态定义为可观察的。这意呀着当这些状态发生变化时，与之相关的观察者（如 React 组件）会自动得到通知并重新渲染。可观察状态可以是对象、数组或基本数据类型。
- **动作（Actions）**：动作是改变可观察状态的函数。在 MobX 中，动作是可选的，但推荐用于修改状态，以确保状态的变化是可跟踪和可预测的。在严格模式下，只有被 `@action` 装饰的方法才能修改状态。
- **计算值（Computed Values）**：计算值是基于其他可观察状态自动计算得来的值。它们具有缓存机制，只有当依赖的属性变化时才会重新计算。计算值既可以是响应式的，也可以是可观察的。
- **反应（Reactions）**：反应是当状态改变时需要自动发生的副作用，如发送请求、更新页面等。MobX 提供了多种反应类型，如 `autorun`、`reaction` 和 `when` 等。

## 2. 依赖追踪与自动更新

MobX 的核心原理之一是自动依赖追踪和状态更新。当代码访问可观察状态时，MobX 会自动追踪这些访问，并建立起一个依赖关系图。当可观察状态发生变化时，MobX 会通知所有依赖于该状态的观察者进行更新。

- **依赖收集**：在 MobX 中，当一个函数（如 React 组件的 render 方法）访问可观察状态时，MobX 会将该函数加入到该可观察状态的依赖列表中。这样，当状态变化时，MobX 就能知道哪些函数需要被重新执行。
- **状态变化通知**：当可观察状态发生变化时，MobX 会遍历该状态的依赖列表，并依次执行列表中的函数。这些函数通常是用于更新 UI 或执行其他副作用的代码。

## 3. 实现机制

MobX 内部使用 ES6 的 Proxy 或 Object.defineProperty（在旧版本中）来实现对可观察状态的拦截和追踪。

- **Proxy**：在 MobX 5 及更高版本中，Proxy 被用于拦截对可观察对象的属性访问和修改。Proxy 可以在目标对象之前架设一层“拦截”，外界对该对象的访问都必须先通过这层拦截，从而提供了一种机制来对外界的访问进行过滤和改写。
- **Object.defineProperty**：在 MobX 4 及更早版本中，由于 Proxy 尚未被广泛支持，MobX 使用 Object.defineProperty 来实现对对象属性的拦截。这种方法通过修改属性的 getter 和 setter 方法来追踪属性的访问和修改。

## 4. 优点与特性

- **简单直观**：MobX 的 API 设计简洁直观，减少了样板代码的数量，使得状态管理变得更加容易。
- **性能高效**：MobX 通过细粒度的依赖追踪和计算值缓存机制，能够提供更优的性能表现。
- **灵活性强**：MobX 允许在不同的组件和层级中灵活地管理状态，而不必像 Redux 那样必须将所有状态集中管理。
- **易于调试**：MobX 提供了强大的开发者工具，可以方便地跟踪和调试状态的变化。

综上所述，MobX 通过可观察状态、自动依赖追踪和状态更新机制，构建了一个高效、灵活且易于使用的状态管理系统。这使得开发者能够更加专注于业务逻辑的实现，而不是状态管理的复杂性。
