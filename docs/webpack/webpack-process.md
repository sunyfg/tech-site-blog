# 构建流程

Webpack 的构建流程是一个复杂但高效的过程，它涉及从读取配置文件到输出最终打包文件的多个步骤。以下是 Webpack 构建流程的详细介绍：

## 一、初始化参数

- **读取配置文件**：Webpack 从 `webpack.config.js` 文件或命令行参数中读取配置信息。这些配置信息包括入口文件（entry）、输出文件（output）、模块处理规则（module）、插件（plugins）等。
- **合并参数**：将配置文件和命令行参数中的信息合并，得到最终的构建参数。

## 二、开始编译

- **初始化 Compiler 对象**：使用上一步得到的参数初始化 Compiler 对象。Compiler 对象掌控着 Webpack 的整个生命周期，负责调度各个构建环节。
- **加载插件**：根据配置加载所有指定的插件，并注册到 Compiler 对象上。这些插件可以监听 Webpack 构建过程中的各种事件，并在特定时机执行自定义逻辑。
- **执行 run 方法**：调用 Compiler 对象的 `run` 方法，开始执行编译过程。

## 三、确定入口

- **查找入口文件**：根据配置中的 `entry` 字段，找到所有入口文件。入口文件是 Webpack 打包的起点。

## 四、编译模块

- **创建模块对象**：对于每个入口文件，Webpack 创建一个对应的模块对象（Module）。
- **加载 Loader**：根据配置中的 `module.rules`，为模块对象分配相应的 Loader。Loader 用于处理非 JavaScript 文件（如 CSS、图片等），将它们转换为浏览器可以识别的格式。
- **翻译模块**：使用 Loader 对模块进行翻译。例如，使用 Babel Loader 将 ES6 代码转换为 ES5 代码，使用 CSS Loader 将 CSS 文件转换为 JavaScript 模块中的字符串等。
- **递归处理依赖**：在翻译模块的过程中，Webpack 会分析模块的依赖关系（如通过 `import`、`require` 引入的其他模块），并递归地处理这些依赖模块。这个过程会一直持续，直到所有依赖都被处理完毕。

## 五、完成模块编译

- **生成依赖关系图**：经过上一步的递归处理，Webpack 会生成一个包含所有模块及其依赖关系的图（Dependency Graph）。
- **确定输出内容**：根据依赖关系图，Webpack 确定最终的输出内容，包括每个模块被翻译后的代码以及它们之间的依赖关系。

## 六、输出资源

- **组装 Chunk**：根据入口文件和模块之间的依赖关系，Webpack 将模块组装成一个个 Chunk（代码块）。每个 Chunk 包含一组相关的模块。
- **生成文件**：将每个 Chunk 转换成一个单独的文件，并加入到输出列表中。这些文件通常包括打包后的 JavaScript 代码、CSS 代码以及图片等资源。
- **写入文件系统**：根据配置中的 `output` 字段，Webpack 将生成的文件写入到指定的文件系统中。

## 七、结束构建

- **输出完成**：在文件写入完成后，Webpack 构建流程结束。此时，开发者可以在指定的输出目录中找到打包后的文件。

在整个构建过程中，Webpack 会在特定的时间点广播出特定的事件。插件可以监听这些事件，并在事件发生时执行自定义的逻辑，从而改变 Webpack 的运行结果。这使得 Webpack 具有高度的可扩展性和灵活性。
